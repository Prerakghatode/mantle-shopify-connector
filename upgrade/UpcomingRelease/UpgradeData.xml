<?xml version="1.0" encoding="UTF-8"?>
<entity-facade-xml type="ext-upgrade">
    <moqui.resource.DbResourceFile resourceId="ExchangesByOrderIdQuery">
            <fileData>
                <![CDATA[<#ftl output_format="HTML">
                    <@compress single_line=true>
                        query {
                            node(id: "${shopifyOrderId}") {
                                id
                                ... on
                                Order {
                                   id
                                    name
                                    exchangeV2s (first: 10<#if cursor?has_content>, after: "${cursor}"</#if>) {
                                        edges {
                                            node {
                                                id
                                                completedAt
                                                location {
                                                    id
                                                }
                                                additions {
                                                    totalPriceSet {
                                                        presentmentMoney {
                                                            amount
                                                            currencyCode
                                                        }
                                                    }
                                                    lineItems {
                                                        lineItem {
                                                            id
                                                            quantity
                                                            sku
                                                            variant{
                                                                id
                                                            }
                                                            variantTitle
                                                            isGiftCard
                                                            product {
                                                                id
                                                                title
                                                            }
                                                            originalUnitPriceSet {
                                                                presentmentMoney {
                                                                    amount
                                                                    currencyCode
                                                                }
                                                            }
                                                            originalTotalSet {
                                                                presentmentMoney {
                                                                    amount
                                                                    currencyCode
                                                                }
                                                            }
                                                            discountedUnitPriceSet {
                                                                presentmentMoney {
                                                                    amount
                                                                    currencyCode
                                                                }
                                                            }
                                                            discountedUnitPriceAfterAllDiscountsSet {
                                                                presentmentMoney {
                                                                    currencyCode
                                                                    amount
                                                                }
                                                            }
                                                            discountedTotalSet {
                                                                presentmentMoney {
                                                                    amount
                                                                    currencyCode
                                                                }
                                                            }
                                                            discountAllocations {
                                                                allocatedAmountSet {
                                                                    presentmentMoney {
                                                                        amount
                                                                        currencyCode
                                                                    }
                                                                }
                                                            }
                                                            taxLines {
                                                                priceSet {
                                                                    presentmentMoney {
                                                                        amount
                                                                        currencyCode
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                refunds {
                                                    id
                                                    totalRefundedSet {
                                                        presentmentMoney {
                                                            amount
                                                            currencyCode
                                                        }
                                                    }
                                                    return {
                                                        id
                                                    }
                                                }
                                                totalAmountProcessedSet {
                                                    presentmentMoney {
                                                        amount
                                                        currencyCode
                                                    }
                                                }
                                                totalPriceSet {
                                                    presentmentMoney {
                                                        amount
                                                        currencyCode
                                                    }
                                                }
                                                transactions {
                                                    id
                                                    parentTransaction {
                                                        id
                                                    }
                                                    kind
                                                    status
                                                    processedAt
                                                    amountSet {
                                                        presentmentMoney {
                                                            amount
                                                            currencyCode
                                                        }
                                                        shopMoney {
                                                            amount
                                                            currencyCode
                                                        }
                                                    }
                                                    gateway
                                                    paymentDetails {
                                                        ... on CardPaymentDetails {
                                                            company
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        pageInfo{
                                            endCursor
                                            hasNextPage
                                        }
                                    }
                                }
                            }
                        }
                    </@compress>
                ]]>
            </fileData>
    </moqui.resource.DbResourceFile>
</entity-facade-xml>
